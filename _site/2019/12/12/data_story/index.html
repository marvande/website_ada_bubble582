<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Tell me what you buy, I will tell you who you are. A data story. | Tell me what you buy and I will tell you who you are</title><meta name="description" content="Insert description here. "><meta itemprop="name" content="Marijn van der Meer"><meta itemprop="description" content="Insert description here. "><meta itemprop="image" content="http://localhost:4000/assets/images/pic07.jpg"><meta property="og:url" content="http://localhost:4000/2019/12/12/data_story/"><meta property="og:type" content="website"><meta property="og:title" content="Tell me what you buy, I will tell you who you are. A data story. | Tell me what you buy and I will tell you who you are"><meta property="og:site_name" content="Tell me what you buy and I will tell you who you are"><meta property="og:description" content="Insert description here. "><meta property="og:image" content="http://localhost:4000/assets/images/pic07.jpg"><link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"><link rel="stylesheet" href="/assets/css/app.min.css"><link rel="alternate" type="application/rss+xml" title="Tell me what you buy and I will tell you who you are" href="/feed.xml"><link rel="canonical" href="/2019/12/12/data_story/"></head><body id="tell-me-what-you-buy-i-will-tell-you-who-you-are-a-data-story" class="post-layout"><header class="header"> <a class="header__title" href="http://localhost:4000/">Tell me what you buy and I will tell you who you are</a><nav><ul class="header__list"><li><a href="/2019/12/12/data_story/">Data Story</a></li><li><span class="popup__open">Contact</span></li></ul></nav></header><main class="💈"><div class="post"><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><div class="post__header section-padding--double"><div class="grid-small"><h2 itemprop="name headline">Tell me what you buy, I will tell you who you are. A data story.</h2><h3 itemprop="name headline">Applied Data Analysis EPFL, Autumn 2019</h3><time class="post__date" datetime="2019-12-12T00:00:00+01:00" itemprop="datePublished">12 Dec 2019</time></div></div><div class="post__img"><div><figure class="absolute-bg" style="background-image: url('/assets/images/pic07.jpg');"></figure></div></div><div class="post__content section-padding"><div class="grid"><div id="markdown" itemprop="articleBody"><style> img { display: block; margin-left: auto; margin-right: auto; } p{ text-align: justify; } iframe { display:block; width:100%; }</style><h4>Preface.</h4><p> Due to rumours about the troublesome ability of shopping centers to infer consumer information based on their shopping patterns, a private investigator, detective Duck, was hired by a consumer advocacy group to investigate the matter. Here are the details of his investigation.</p><p><img class="center" src="http://localhost:4000/assets/images/pic08.png" alt="Markdown Monster icon" width="200" height="150" /></p><p> Living in a time and age when every piece of our data is stored and analysed, the consumer advocacy group wondered what information retailers can gather and infer about consumers. Nevertheless, to answer their question, the group could only provide Detective Duck with information about a two year shopping spree of clients of an unknown shopping center based in the US. Based on this data, Duck was tasked with identifying possible links, if they exist, between demographic information (e.g. marital status, income, number of children, etc) and purchase patterns. In other words, he needed to find out how easy it is for retailers to infer a specific customer profile based on their shopping habits. This was crucial to the consumer advocacy group as precise customer profiles lead to targeted marketing and loss of privacy. Luckily, Detective Duck followed the autumn 2019 Applied Data Analysis course at the EPFL and applied his newly acquired knowledge with diligence to this case.</p><p><br /></p><hr /><h4>Chapter 1. A rocky start to a rocky investigation.</h4><p><em><strong>A Dunnhumby dataset.</strong></em></p><p> The consumer advocacy group provided Detective Duck with a dataset owned by Dunhumby, an American Data Science company. This included the results of a two years long study, of 2500 voluntary households. When looking at the dataset, Duck quickly realised that this dataset was rather big and had a lot of miscellaneous information. Nevertheless, our favourite detective has learned that when faced with this challenge, one has to start by pre-processing and cleaning the available information. For this, he kept only households which showed coherent and sufficient demographic data. Furthermore, he labelled all 10'000 products into precise grocery categories, as shown below. In this graph, Duck plotted the number of occurences per label for all the transactions. There, he noticed that most transactions fell into five major labels : vegetables, meat &amp; seafood, cookies &amp; snacks &amp; candy, dairy and beverages. This was not a major surprise to him. <img class="center" src="http://localhost:4000/assets/images/products_trans_newlabel.png" alt="Markdown Monster icon" width="900" height="700" /></p><p><em><strong>Know thy households.</strong></em></p><p> Before starting to hunt for clues, Detective Duck first had to know what kind of households were present in his data. That is when he was first shocked in his investigation. Indeed, after cleaning the 2500 households studied by Dunhumby, only 750 remained that provided their demographic information. At this moment, suspicions started to arise in detective Duck's mind that the consumer advocacy group had provided him with quite a challenge. Undoubtetly, such a small dataset would cause troubles when trying to draw predictions. Duck regretted ever leaving his cozy pond.</p><p><img class="center" src="http://localhost:4000/assets/images/pic09.png" alt="Markdown Monster icon" width="300" height="150" /></p><p> Still, Duck aimed to extract the clients' main consumption patterns and correlate them with their demographic features. For this, he developped several strategies that will be developped below.</p><p><br /></p><hr /><h4>Chapter 2. Profiling is not a piece of cake..</h4><p> Once the data was ready for analysis, Detective Duck was excited to face the real challenge: customer profile hunting.</p><p><em><strong> A hunt for correlations.</strong></em></p><p> Detective Duck seeked for major correlation patterns in the whole data. After some coding, he produced the following matrix to illustrate the strength of relation between demographic features, spendings and the products quantities for the most common labels.</p><p><img class="center" src="http://localhost:4000/assets/images/correlation-matrix1.png" alt="Markdown Monster icon" width="600" height="400" /></p><p> From this, he learned that there is some high correlation between demographic information. Specifically, household size is highly correlated to the number of kids and marital status. This did not surprise Duck as any good detective could have deduced it. Nevertheless, he noted that most households with kids were married in this study. Furthermore, the mean and yearly spending were also correlated (0.7) with the different products quantities. This did not alarm Duck, as spending more usually means buying more products in a grocery store. Unfortunately, he could not find any direct link between demographics and product quantities. Unsatisfied with this result, he decided to further pursue the matter, as it seemed too easy. Duck supposed that no correlation between labels and demographics could mean that the labels were not specific enough. Indeed, all households probably buy globally the same amounts in the categories of vegetables, meat, dairy products, etc. Thus, except for outliers with extreme diets, all households seem to buy from the same grocery categories.</p><iframe src="https://gfycat.com/ifr/AdmiredGlumBluebreastedkookaburra" frameborder="0" scrolling="no" width="60%" height="60%" style="position:absolute;top:0;left:0;" allowfullscreen=""> </iframe><p><br /></p><hr /><p><em><strong> A duck in a random forest.</strong></em></p><p> Our favourite duck is not the kind of duck that gives up when discovering weak correlations, the consumer group hired him because he is the best in the field. Thus, he decided to follow another path and to seek help from Machine Learning, more specifically, Random Forests. He built a predictive model that would hopefully find things, he as a simple duck, could not. First, he fitted a decision tree on the monthly product quantities bought by all households with available demographic information. The results for this were regretfully bad. So bad that Duck could have just randomly set a random demographic parameter for each household and the result would have been better (e.g. the ROC AUC score barely exceeded the baseline score). The same occurred when fitting a random forest model. Thus, he concluded that, using only labels, there was not enough data to train a good machine learning model and infer satisfying customer profiles. Disappointed but not surprised as he had already suspected something of the sort would happen (see section <i>Know thy households</i>), Duck resigned to pursue another investigation path, as he had not yet said his last word.</p><p><img class="center" src="http://localhost:4000/assets/images/pic10.jpg" alt="Markdown Monster icon" width="400" height="200" /></p><p><em><strong>Smart clustering by a strategic duck.</strong></em></p><p> Duck needed to change his plan of action as he had promised to deliver. Thus, he decided to search for typical grocery carts present in the data. From this, he hoped to be able to relate them to demographic parameters. To look for general carts, he pursued several ideas.</p><p><i>Product clusters:</i></p><p>His first idea was to toss aside labels and focus on specific products. So, he looked to cluster households by the exact weekly product quantities they bought, the hope being that different typical weekly shopping carts would appear (e.g. a weekly shopping cart with bananas and cheddar cheese). To identify the ideal number of clusters in the data, he used the elbow method and found a number between 5 and 9.</p><p><img class="center" src="http://localhost:4000/assets/images/elbow7.png" alt="Markdown Monster icon" width="500" height="400" /></p><p> This he used with k-means and created 7 households clusters. To identify what those clusters bought weekly, he decided that for a product to caracterize a cluster, it had to be bought by at least a third of the households in the clutster (a very generous threshold). Looking at the results, Duck saw that two clusters contained only a single household and that one contained around a 1000 but had no product in common and dismissed those. Furthermore, the remaining clusters had either bananas or dairy as their caracteristic product. From this, Duck started to wonder if this dataset was a cruel joke that someone had played on him, or wether this shopping center was frequented by what seemed to be a troop of monkeys. Detective Duck concluded that though labels were too vague, clustering on products was probably too precise as there were several product IDs for the same type of product (e.g. 5 different milk IDs). So though some households maybe bought the same weekly quantity of milk, because they bought a different brand there carts were not assimilated as the same.</p><p><p><i>Department clusters:</i></p><p> Barely recovered from his banana and milk experience, Duck's second idea was to look for clusters in the labels and departments of the products. Reminder, departmetns include "Produce", "Grocery", "Drug and general merchandise", etc. After an SVD on the weekly average amount of products bought per deparments and on labels, the detective found that two dimensions explain 96% of total variance in the departments and 70% in the labels. So, he plotted the data along these two dimensions and colored it according to different demographic labels to search for clusters. See below, a 2D representation of the department and label data colored according to different demographics.</p><div class="row justify-content-md-center"><div class="column"> <img class="center" src="http://localhost:4000/assets/images/notebook_images/departsvd1.png" alt="Markdown Monster icon" width="360" height="250" /></div><div class="column"> <img class="center" src="http://localhost:4000/assets/images/notebook_images/departsvd2.png" alt="Markdown Monster icon" width="360" height="250" /></div></div><div class="row justify-content-md-center"><div class="column"> <img class="center" src="http://localhost:4000/assets/images/notebook_images/labelsvd1.png" alt="Markdown Monster icon" width="360" height="250" /></div><div class="column"> <img class="center" src="http://localhost:4000/assets/images/notebook_images/labelsvd2.png" alt="Markdown Monster icon" width="360" height="250" /></div></div><p>Though visually he could not find any, he still wanted to be sure that none were hiding so he applied the heuristic elbow method for a cluster number from 2 to 20. This method found an ideal number of 4 clusters for departments but none for labels. Full of hope, Duck applied K-means with 4 clusters to the department data and had a closer look at them in the hope of discovering something.</p><div class="row"><div class="column"> <img class="center" src="http://localhost:4000/assets/images/notebook_images/department_clusters.png" alt="Markdown Monster icon" width="400" height="250" /></div><div class="column"> <img class="center" src="http://localhost:4000/assets/images/notebook_images/barclusters.png" alt="Markdown Monster icon" width="375" height="300" /></div></div><p>Interestingly, Duck noticed that the clusters were influenced by the quantity of groceries bought. So, the only thing that seemed to distinguish households was how much groceries they bought weekly at this retailer. To see whether there were any other indicators in those clusters, Detective Duck decided to look at the biggest cluster and see whether there was any correlation within the cluster. Note: though there are around 1000 households in this cluster to calculate correlation between labels, there is only demographic information for 22 of them. So, all correlation calculations done between demographics and something else was with only 22 datapoints.</p><img class="center" src="http://localhost:4000/assets/images/notebook_images/cluster4_correlation.png" alt="Markdown Monster icon" width="600" height="400" /><p> To Duck's delight, some bigger correlations appeared within the cluster. Notably, within this cluster there seemed to be some indication of a link between the weekly quantity of dairy bought and the number of kids/household size. This reminds the detective of the weird dairy and banana clusters that appeared when evaluating products. These clusters could be an indicator that, when separating households first according to how much they buy weekly at this retailer, one might get a better idea of their shopping patterns and relate them better to their demographics. Nevertheless, to conclude anything solid, Duck would have needed way more demographic data.</p><p> Though the correlation data had to be taken into account carefully because of the scarcity of demographic data, but not wanting to give up on his newly found clusters, Detective Duck decided to look at the proportion of label consumption for eahc cluster to see if there was anything separating them except the quantity of weekly groceries bought. Disappointingly, the proportions seemed rather similar, but Duck suspected that this was due to the fact that, as seen previously, labels are too global and most households buy the same thing. Instead of looking at average proportions, Duck suspected he should have looked at the proportions of outsiders in the clusters instead. But again, there was not enough data for that and our beloved detective was short on time.</p><div class="row"><div class="column"> <img class="center" src="http://localhost:4000/assets/images/notebook_images/clusterprop_1.png" alt="Markdown Monster icon" width="400" height="300" /></div><div class="column"> <img class="center" src="http://localhost:4000/assets/images/notebook_images/clusterprop_2.png" alt="Markdown Monster icon" width="375" height="300" /></div></div><div class="row"><div class="column"> <img class="center" src="http://localhost:4000/assets/images/notebook_images/clusterprop_3.png" alt="Markdown Monster icon" width="400" height="300" /></div><div class="column"> <img class="center" src="http://localhost:4000/assets/images/notebook_images/clusterprop_4.png" alt="Markdown Monster icon" width="375" height="300" /></div></div><br /><hr /><p><h4>Chapter 3. A reassuring report to the Consumer Advocacy Group</h4><p><p> After this investigation full of twists and turns, Duck's report to the C.A.G was the following:</p><p><i> “Due to the found results, there should be no cause for immediate worry. Though armed with extended data analysis ressources, I did not discover anything big from clients'shopping habits, at least not at the scale of this single retailer. To find anything signficant, retailers would need to build a clever data collection. So, to infer who their customers are, they would need to harvest a lot more demographic information of a way bigger and more diverse client sample. Indeed, globally households behave quite similarly, no matter their social class. The only danger right now it seems of targeted marketing, is that reailers can collect individual shopping habits and target you this way based on what you buy. Nevertheless, it seems that it is hard (at least it was for me) to predict who you are.” </i></p><p><i>What Duck could have done better.</i></p><p> The data collection the detective has analyzed might have been atypical. Since he did not have any information about the location nor the identiy of the shopping center, he could not claim that it represented an average American grocery store. Moreover, the number of households who gave their demographic features was very limited. As accuracies of machine learning models highly rely on the dataset size, Duck stipulates that his results were probably biased by a too small dataset. Furthermore, he chose the product’s labels rather arbitrarily. They were set based on the common classes of food he personally knew. This could have been done wiht higher precision, based on existing labeling available or using classification based on machine learning.</p><p><i>An open investigation.</i></p><p> To be completely 100% re-assured, Duck advised the C.A.G to run a meta analysis among several shopping centers, in order to confirm or infirm his conclusions. The household set for each center should preferably be bigger and the products classification should be comparable in between the different grocery stores.<p><p>Good job detective Duck. But our favorite detective does not even hear us. The smart little guy is already on his way to a new investigation.</p><img class="center" src="http://localhost:4000/assets/images/ducktective_murder.png" alt="Markdown Monster icon" width="200" height="150" /></p></p></p></p></p></div><ul class="post__social"><li><a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2019/12/12/data_story/" target="_blank"><i class="fa fa-facebook"></i></a></li><li><a href="https://twitter.com/intent/tweet?&text=Tell me what you buy, I will tell you who you are. A data story.+http://localhost:4000/2019/12/12/data_story/" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?mini=true&source=Tell me what you buy, I will tell you who you are. A data story.&summary=&url=http://localhost:4000/2019/12/12/data_story/" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://www.reddit.com/submit?url=http://localhost:4000/2019/12/12/data_story/" target="_blank"><i class="fa fa-reddit-alien"></i></a></li></ul></div></div></article></div></main><footer class="footer section-padding"><div class="grid"><hr class="sep--white" /><div class="footer__container"><ul class="footer__tags"></ul><ul class="footer__social"><li><a href="https://github.com/marvande/epfl-ada-2019-project-bubble582" target="_blank"><i class="fa fa-github"></i></a></li></ul></div></div></footer><section class="contact popup"><div class="popup__close"><div class="popup__exit"></div></div><div class="contact__container popup__container"><div class="contact__img"><figure class="absolute-bg" style="background-image: url(/assets/images/pic06.jpg);"></figure></div><div class="contact__content"><div class="contact__mast section-padding--half"><div class="grid"><h2>Contact</h2></div></div><div class="section-padding--none"><hr class="sep"/></div><div class="contact__form section-padding--half"><div class="grid-xlarge"> <form id="form" class="form" action="https://formcarry.com/s/HkIo0nMb7" method="POST"><div class="form__subcontainer"><div> <label for="form-first-name">First Name</label> <input type="text" name="first-name" id="form-first-name" required></div><div> <label for="form-last-name">Last Name</label> <input type="text" name="last-name" id="form-last-name" required></div></div><div> <label for="form-email">E-Mail</label> <input type="email" name="email" id="form-email" required></div><div> <label for="form-message">Message</label> <textarea name="message" id="form-message" rows="3"></textarea></div><div class="form__submit"><div class="form__btn"> <input type="submit" value="Send"></div></div><p class="form__message"></p></form></div></div></div></div></section><script src="/assets/js/app.min.js"></script></body></html>
  